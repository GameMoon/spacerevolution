<!DOCTYPE html>
<html>
 
<head>
    <title>Space Revolution</title>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
 
<body>
    <canvas id="screen" class="canvas"></canvas>
    <img id="overlay" src="overlay.png"></img>
    <!--<button class="mybutton">Run myFunction</button><br>-->
    <button class="FullscreenButton">Start Game</button>

    <script>
        var Module = {
            print: function(text) { console.log('stdout: ' + text) },
            printErr: function(text) { console.error('stderr: ' + text) },
        };
    </script>
    <script src="index.js"></script>
    
    <script>
        
        /*async function loadImage(src) {
            // Load image
            const imgBlob = await fetch(src).then(resp => resp.blob());
            const img = await createImageBitmap(imgBlob);
            // Make canvas same size as image
            const canvas = document.createElement('canvas');
            canvas.width = img.width;
            canvas.height = img.height;
            // Draw image onto canvas
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0);
            var imageData = ctx.getImageData(0, 0, img.width, img.height);
            console.log(imageData);
            return imageData;
        }*/

        Module.renderImageFromMemory = function(){
            this.canvasContext.putImageData(this.imageData,0,0);
            this.canvasContext.drawImage(overlay, 0, 0);
        }
      
        Module.onRuntimeInitialized = function() {
            var canvas = document.getElementById('screen');
            this.canvasContext = canvas.getContext('2d');
            var width = this._getScreenWidth();
            var height = this._getScreenHeight();
            var offset = this._getMemoryOffset();
            canvas.width = width;
            canvas.height = height;
            this.imageData = new ImageData( new Uint8ClampedArray(this.wasmMemory.buffer, offset,width*height*4), width, height);

            document.querySelector('.FullscreenButton').addEventListener('click', function () {
                openFullscreen();
                StartGame();
                running = false;
            });
            
            document.addEventListener('keydown', function(event) {
                if(event.getModifierState("Alt") && event.keyCode == 13) {
                    openFullscreen();
                    StartGame();
            }
            });
            canvas.addEventListener('click', function(event) {
                var clickXPos=event.x;
                var clickYPos=event.y;
                alert("Mouse X: "+event.x+" Mouse Y: "+event.y);
            });
            /*document.querySelector('.mybutton').addEventListener('click', function () {
                alert("Run myFunction");
                Module.renderImageFromMemory();
                running = false;
            });*/
        }

        function StartGame() {

            const startgame= Module.cwrap('startgame');
            startgame();
        }

        function openFullscreen() {
                var canvas = document.getElementById('screen');
                if (canvas.requestFullscreen) {
                    canvas.requestFullscreen();
                } else if (canvas.mozRequestFullScreen) { /* Firefox */
                    canvas.mozRequestFullScreen();
                } else if (canvas.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
                    canvas.webkitRequestFullscreen();
                } else if (canvas.msRequestFullscreen) { /* IE/Edge */
                    canvas.msRequestFullscreen();
                }
            }
    </script>
</body>
 
</html>